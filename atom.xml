<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://hefeijoe.github.io/</id>
    <title>HefeiJoe Blog</title>
    <updated>2020-05-28T02:58:01.643Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://hefeijoe.github.io/"/>
    <link rel="self" href="https://hefeijoe.github.io/atom.xml"/>
    <subtitle>æ°´æ»´çŸ³ç©¿</subtitle>
    <logo>https://hefeijoe.github.io/images/avatar.png</logo>
    <icon>https://hefeijoe.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, HefeiJoe Blog</rights>
    <entry>
        <title type="html"><![CDATA[Javaä¸­çš„å †(heap)å’Œæ ˆ(stack)]]></title>
        <id>https://hefeijoe.github.io/post/stackandheap/</id>
        <link href="https://hefeijoe.github.io/post/stackandheap/">
        </link>
        <updated>2020-05-28T01:48:09.000Z</updated>
        <content type="html"><![CDATA[<h1 id="æ ˆstack">æ ˆ(stack)ğŸ¤ </h1>
<p>Javaé‡Œé¢Stackæœ‰ä¸¤ç§å«ä¹‰ï¼š</p>
<h2 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</h2>
<p>Stack,å³java.util.Stackï¼Œæ˜¯Vectorçš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒå®ç°äº†ä¸€ä¸ªæ ‡å‡†çš„åè¿›å…ˆå‡ºçš„æ ˆã€‚<br>
Stackçš„ç‰¹ç‚¹ä¸ºLIFOï¼Œå³åè¿›å…ˆå‡ºï¼ˆLast in, first outï¼‰ã€‚</p>
<pre><code>public class Stack01 {
    public static void main(String[] args) {
        Stack&lt;Integer&gt; stack = new Stack&lt;&gt;();
        stack.push(1);//æŠŠå…ƒç´ å‹æ ˆ
        stack.empty();//åˆ¤æ–­stackæ˜¯å¦ä¸ºç©º
        stack.peek();//å–æ ˆé¡¶å…ƒç´ ä½†ä¸å¼¹å‡º
        stack.search(1);//è¿”å›å¯¹è±¡åœ¨å †æ ˆä¸­çš„ä½ç½®ï¼Œä»¥ 1 ä¸ºåŸºæ•°ã€‚æ²’æœ‰æŸ¥åˆ°åˆ™è¿”å›-1ã€‚
        stack.pop();//æŠŠæ ˆé¡¶çš„å…ƒç´ â€œå¼¹å‡ºâ€
    }
}
</code></pre>
<p>ä¸€èˆ¬ä¸ä¹‹æ¯”è¾ƒçš„æ˜¯é˜Ÿåˆ—Queueï¼Œé˜Ÿåˆ—æ˜¯ä¸¤ä¸ªå£ï¼Œå…ˆè¿›å…ˆå‡ºã€‚</p>
<h2 id="å†…å­˜åŒºåŸŸ">å†…å­˜åŒºåŸŸğŸ˜š</h2>
<p>ç³»ç»Ÿä¸€èˆ¬åœ¨å†…å­˜ä¸­åˆ’åˆ†å‡ºä¸¤ç§ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œä¸€ç§æ˜¯Stack(æ ˆ),ä¸€ç§æ˜¯heap(å †)ã€‚<br>
<img src="https://pic1.zhimg.com/80/v2-e83cdfa865e6fb71caf65d7803c081bc_720w.jpg" alt="stack" loading="lazy"></p>
<h3 id="æ ˆçš„ç»„æˆ">æ ˆçš„ç»„æˆ</h3>
<p>æ ˆå¸§ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š<strong>å±€éƒ¨å˜é‡åŒº</strong>ã€<strong>æ“ä½œæ•°æ ˆ</strong>ã€<strong>å¸§æ•°æ®åŒº</strong>ã€‚å±€éƒ¨å˜é‡åŒºå’Œæ“ä½œæ•°æ ˆçš„å¤§å°è¦è§†å¯¹åº”çš„æ–¹æ³•è€Œå®šï¼Œä»–ä»¬æ˜¯æŒ‰å­—é•¿è®¡ç®—çš„ã€‚ä½†è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒä»ç±»å‹ä¿¡æ¯ä¸­å¾—åˆ°æ­¤æ–¹æ³•å±€éƒ¨å˜é‡åŒºå’Œæ“ä½œæ•°æ ˆå¤§å°ï¼Œå¹¶æ®æ­¤åˆ†é…æ ˆå†…å­˜ï¼Œç„¶åå‹å…¥Javaæ ˆã€‚</p>
<h4 id="å±€éƒ¨å˜é‡åŒº">å±€éƒ¨å˜é‡åŒº</h4>
<p><strong>å±€éƒ¨å˜é‡åŒº</strong>è¢«ç»„ç»‡ä¸ºä»¥ä¸€ä¸ªå­—é•¿ä¸ºå•ä½ã€ä»0å¼€å§‹è®¡æ•°çš„æ•°ç»„ï¼Œç±»å‹ä¸ºshortã€byteå’Œcharçš„å€¼åœ¨å­˜å…¥æ•°ç»„å‰è¦è¢«è½¬æ¢æˆintå€¼ï¼Œè€Œlongå’Œdoubleåœ¨æ•°ç»„ä¸­å æ®è¿ç»­çš„ä¸¤é¡¹ï¼Œåœ¨è®¿é—®å±€éƒ¨å˜é‡ä¸­çš„longæˆ–doubleæ—¶ï¼Œåªéœ€å–å‡ºè¿ç»­ä¸¤é¡¹çš„ç¬¬ä¸€é¡¹çš„ç´¢å¼•å€¼å³å¯,å¦‚æŸä¸ªlongå€¼åœ¨å±€éƒ¨å˜é‡åŒºä¸­å æ®çš„ç´¢å¼•æ—¶3ã€4é¡¹ï¼Œå–å€¼æ—¶ï¼ŒæŒ‡ä»¤åªéœ€å–ç´¢å¼•ä¸º3çš„longå€¼å³å¯ã€‚</p>
<pre><code>public static int runClassMethod(int i,long l,float f,double d,Object o,byte b) { 
    return 0;   
}
public int runInstanceMethod(char c,double d,short s,boolean b) { 
    return 0;   
}
</code></pre>
<h4 id="æ“ä½œæ•°æ ˆ">æ“ä½œæ•°æ ˆ</h4>
<p>å’Œå±€éƒ¨å˜é‡åŒºä¸€æ ·ï¼Œæ“ä½œæ•°æ ˆä¹Ÿè¢«ç»„ç»‡æˆä¸€ä¸ªä»¥å­—é•¿ä¸ºå•ä½çš„æ•°ç»„ã€‚ä½†å’Œå‰è€…ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸æ˜¯é€šè¿‡ç´¢å¼•æ¥è®¿é—®çš„ï¼Œè€Œæ˜¯é€šè¿‡å…¥æ ˆå’Œå‡ºæ ˆæ¥è®¿é—®çš„ã€‚å¯æŠŠæ“ä½œæ•°æ ˆç†è§£ä¸ºå­˜å‚¨è®¡ç®—æ—¶ï¼Œä¸´æ—¶æ•°æ®çš„å­˜å‚¨åŒºåŸŸã€‚<br>
æ“ä½œæ•°æ ˆå…¶å®å°±æ˜¯ä¸ªä¸´æ—¶æ•°æ®å­˜å‚¨åŒºåŸŸï¼Œå®ƒæ˜¯é€šè¿‡å…¥æ ˆå’Œå‡ºæ ˆæ¥è¿›è¡Œæ“ä½œçš„ã€‚</p>
<h4 id="å¸§æ•°æ®åŒº">å¸§æ•°æ®åŒº</h4>
<p>åœ¨å‰é¢å°±æè¿°è¿‡ï¼šæ ˆæ˜¯ç”±æ ˆå¸§ç»„æˆï¼Œæ¯å½“çº¿ç¨‹è°ƒç”¨ä¸€ä¸ªjavaæ–¹æ³•æ—¶ï¼ŒJVMå°±ä¼šåœ¨è¯¥çº¿ç¨‹å¯¹åº”çš„æ ˆä¸­å‹å…¥ä¸€ä¸ªå¸§ï¼Œè€Œå¸§æ˜¯ç”±å±€éƒ¨å˜é‡åŒºã€æ“ä½œæ•°æ ˆå’Œå¸§æ•°æ®åŒºç»„æˆã€‚</p>
<ol>
<li>åªæœ‰åœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæ‰ä¸ºå½“å‰æ ˆåˆ†é…ä¸€ä¸ªå¸§ï¼Œç„¶åå°†è¯¥å¸§å‹å…¥æ ˆ;</li>
<li>å¸§ä¸­å­˜å‚¨äº†å¯¹åº”æ–¹æ³•çš„å±€éƒ¨æ•°æ®ï¼Œæ–¹æ³•æ‰§è¡Œå®Œï¼Œå¯¹åº”çš„å¸§åˆ™ä»æ ˆä¸­å¼¹å‡ºï¼Œå¹¶æŠŠè¿”å›ç»“æœå­˜å‚¨åœ¨è°ƒç”¨æ–¹æ³•çš„å¸§çš„æ“ä½œæ•°æ ˆä¸­ã€‚</li>
</ol>
<h1 id="å †">å †ğŸ˜µ</h1>
<p>å †ä¸­åˆ†é…çš„æ˜¯å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯newå‡ºæ¥çš„ä¸œè¥¿ã€‚<br>
<img src="https://pic1.zhimg.com/80/v2-00dc88198eef4f42a3dd1e34ee5cd5f7_720w.jpg" alt="heap" loading="lazy"></p>
<h1 id="å†…å­˜åˆ†é…ä¸¾ä¸ªæ —å­">å†…å­˜åˆ†é…ï¼ˆä¸¾ä¸ªæ —å­ï¼‰</h1>
<pre><code>public void Method1()
{
    int i = 4;
    int y = 2;
    class1 cls1 = new class1();
}
</code></pre>
<p>å†…å­˜åˆ†é…æ˜¯è¿™æ ·çš„ï¼š<br>
<img src="https://pic1.zhimg.com/80/1519fb641bdb1ee150fcfb621b0afdd8_720w.jpg" alt="img" loading="lazy"></p>
<h1 id="å †å’Œæ ˆçš„åŒºåˆ«">å †å’Œæ ˆçš„åŒºåˆ«ğŸ¤—</h1>
<ul>
<li>åŠŸèƒ½ä¸åŒ<br>
æ ˆå†…å­˜ç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨ã€‚<br>
è€Œå †å†…å­˜ç”¨æ¥å­˜å‚¨Javaä¸­çš„å¯¹è±¡ã€‚æ— è®ºæ˜¯æˆå‘˜å˜é‡ï¼Œå±€éƒ¨å˜é‡ï¼Œè¿˜æ˜¯ç±»å˜é‡ï¼Œå®ƒä»¬æŒ‡å‘çš„å¯¹è±¡éƒ½å­˜å‚¨åœ¨å †å†…å­˜ä¸­ã€‚</li>
<li>å…±äº«æ€§ä¸åŒ<br>
Â Â æ ˆå†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚<br>
Â Â å †å†…å­˜æ˜¯æ‰€æœ‰çº¿ç¨‹å…±æœ‰çš„ã€‚</li>
<li>å¼‚å¸¸é”™è¯¯ä¸åŒ<br>
Â Â å¦‚æœæ ˆå†…å­˜æˆ–è€…å †å†…å­˜ä¸è¶³éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚<br>
Â Â æ ˆç©ºé—´ä¸è¶³ï¼šjava.lang.StackOverFlowErrorã€‚<br>
Â Â å †ç©ºé—´ä¸è¶³ï¼šjava.lang.OutOfMemoryErrorã€‚</li>
<li>ç©ºé—´å¤§å°<br>
Â Â æ ˆçš„ç©ºé—´å¤§å°è¿œè¿œå°äºå †çš„ã€‚</li>
<li>ç»“æ„<br>
Â Â stackæ˜¯æœ‰ç»“æ„çš„ï¼Œæ¯ä¸ªåŒºå—æŒ‰ç…§ä¸€å®šæ¬¡åºå­˜æ”¾ï¼Œå¯ä»¥æ˜ç¡®çŸ¥é“æ¯ä¸ªåŒºå—çš„å¤§å°ï¼›heapæ˜¯æ²¡æœ‰ç»“æ„çš„ï¼Œæ•°æ®å¯ä»¥ä»»æ„å­˜æ”¾ã€‚å› æ­¤ï¼Œstackçš„å¯»å€é€Ÿåº¦è¦å¿«äºheapã€‚</li>
<li>å­˜æ”¾è§„åˆ™<br>
Â Â æ•°æ®å­˜æ”¾çš„è§„åˆ™æ˜¯ï¼šåªè¦æ˜¯å±€éƒ¨çš„ã€å ç”¨ç©ºé—´ç¡®å®šçš„æ•°æ®ï¼Œä¸€èˆ¬éƒ½å­˜æ”¾åœ¨stacké‡Œé¢ï¼Œå¦åˆ™å°±æ”¾åœ¨heapé‡Œé¢ã€‚</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Traefik V2åŸºäºKubernetesçš„å®‰è£…ä¸ä½¿ç”¨]]></title>
        <id>https://hefeijoe.github.io/post/traefik-k8s-use/</id>
        <link href="https://hefeijoe.github.io/post/traefik-k8s-use/">
        </link>
        <updated>2020-05-20T07:05:06.000Z</updated>
        <content type="html"><![CDATA[<h1 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µğŸ˜€</h1>
<p>Traefik æ˜¯ä¸€ä¸ªè¾¹ç¼˜è·¯ç”±å™¨ï¼Œæ˜¯ä½ æ•´ä¸ªå¹³å°çš„å¤§é—¨ï¼Œæ‹¦æˆªå¹¶è·¯ç”±æ¯ä¸ªä¼ å…¥çš„è¯·æ±‚ï¼šå®ƒçŸ¥é“æ‰€æœ‰çš„é€»è¾‘å’Œè§„åˆ™ï¼Œè¿™äº›è§„åˆ™ç¡®å®šå“ªäº›æœåŠ¡å¤„ç†å“ªäº›è¯·æ±‚ï¼›ä¼ ç»Ÿçš„åå‘ä»£ç†éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«è·¯ç”±åˆ°ä½ æœåŠ¡çš„æ‰€æœ‰å¯èƒ½è·¯ç”±ï¼Œè€Œ Traefik ä¼šå®æ—¶æ£€æµ‹æœåŠ¡å¹¶è‡ªåŠ¨æ›´æ–°è·¯ç”±è§„åˆ™ï¼Œå¯ä»¥è‡ªåŠ¨æœåŠ¡å‘ç°ã€‚<br>
<img src="https://docs.traefik.io/assets/img/traefik-architecture.png" alt="img" loading="lazy"><br>
é¦–å…ˆï¼Œå½“å¯åŠ¨ Traefik æ—¶ï¼Œéœ€è¦å®šä¹‰ entrypointsï¼ˆå…¥å£ç‚¹ï¼‰ï¼Œç„¶åï¼Œæ ¹æ®è¿æ¥åˆ°è¿™äº› entrypoints çš„è·¯ç”±æ¥åˆ†æä¼ å…¥çš„è¯·æ±‚ï¼Œæ¥æŸ¥çœ‹ä»–ä»¬æ˜¯å¦ä¸ä¸€ç»„è§„åˆ™ç›¸åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™è·¯ç”±å¯èƒ½ä¼šå°†è¯·æ±‚é€šè¿‡ä¸€ç³»åˆ—ä¸­é—´ä»¶è½¬æ¢è¿‡åå†è½¬å‘åˆ°ä½ çš„æœåŠ¡ä¸Šå»ã€‚åœ¨äº†è§£ Traefik ä¹‹å‰æœ‰å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µæˆ‘ä»¬å¿…é¡»è¦äº†è§£ï¼š</p>
<ul>
<li><strong>Providers</strong> ç”¨æ¥è‡ªåŠ¨å‘ç°å¹³å°ä¸Šçš„æœåŠ¡ï¼Œå¯ä»¥æ˜¯ç¼–æ’å·¥å…·ã€å®¹å™¨å¼•æ“æˆ–è€… key-value å­˜å‚¨ç­‰ï¼Œæ¯”å¦‚ Dockerã€Kubernetesã€Fileã€‚</li>
<li><strong>Entrypoints</strong> ç›‘å¬ä¼ å…¥çš„æµé‡ï¼ˆç«¯å£ç­‰â€¦ï¼‰ï¼Œæ˜¯ç½‘ç»œå…¥å£ç‚¹ï¼Œå®ƒä»¬å®šä¹‰äº†æ¥æ”¶è¯·æ±‚çš„ç«¯å£ï¼ˆHTTP æˆ–è€… TCPï¼‰ã€‚</li>
<li><strong>Routers</strong> åˆ†æè¯·æ±‚ï¼ˆhost, path, headers, SSL, â€¦ï¼‰ï¼Œè´Ÿè´£å°†ä¼ å…¥è¯·æ±‚è¿æ¥åˆ°å¯ä»¥å¤„ç†è¿™äº›è¯·æ±‚çš„æœåŠ¡ä¸Šå»ã€‚</li>
<li><strong>Services</strong> å°†è¯·æ±‚è½¬å‘ç»™ä½ çš„åº”ç”¨ï¼ˆload balancing, â€¦ï¼‰ï¼Œè´Ÿè´£é…ç½®å¦‚ä½•è·å–æœ€ç»ˆå°†å¤„ç†ä¼ å…¥è¯·æ±‚çš„å®é™…æœåŠ¡ã€‚</li>
<li><strong>Middlewares</strong> ä¸­é—´ä»¶ï¼Œç”¨æ¥ä¿®æ”¹è¯·æ±‚æˆ–è€…æ ¹æ®è¯·æ±‚æ¥åšå‡ºä¸€äº›åˆ¤æ–­ï¼ˆauthentication, rate limiting, headers, â€¦ï¼‰ï¼Œä¸­é—´ä»¶è¢«é™„ä»¶åˆ°è·¯ç”±ä¸Šï¼Œæ˜¯ä¸€ç§åœ¨è¯·æ±‚å‘é€åˆ°ä½ çš„æœåŠ¡ä¹‹å‰ï¼ˆæˆ–è€…åœ¨æœåŠ¡çš„å“åº”å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰ï¼‰è°ƒæ•´è¯·æ±‚çš„ä¸€ç§æ–¹æ³•ã€‚</li>
</ul>
<h1 id="éƒ¨ç½²">éƒ¨ç½²ğŸ˜„</h1>
<h2 id="kubernetes">Kubernetes</h2>
<p>ç”±äº Traefik 2.X ç‰ˆæœ¬å’Œä¹‹å‰çš„ 1.X ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œæˆ‘ä»¬è¿™é‡Œé€‰æ‹©åŠŸèƒ½æ›´åŠ å¼ºå¤§çš„ 2.X ç‰ˆæœ¬è¿›è¡Œéƒ¨ç½²ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„é•œåƒæ˜¯ traefik:2.0.2ã€‚<br>
åœ¨ Traefik ä¸­çš„é…ç½®å¯ä»¥ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼š</p>
<ul>
<li><strong>åŠ¨æ€é…ç½®</strong>ï¼šå®Œå…¨åŠ¨æ€çš„è·¯ç”±é…ç½®</li>
<li><strong>é™æ€é…ç½®</strong>ï¼šå¯åŠ¨é…ç½®<br>
é™æ€é…ç½®ä¸­çš„å…ƒç´ ï¼ˆè¿™äº›å…ƒç´ ä¸ä¼šç»å¸¸æ›´æ”¹ï¼‰è¿æ¥åˆ° providers å¹¶å®šä¹‰ Treafik å°†è¦ç›‘å¬çš„ entrypointsã€‚<br>
åœ¨ Traefik ä¸­æœ‰ä¸‰ç§æ–¹å¼å®šä¹‰é™æ€é…ç½®ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­ã€åœ¨å‘½ä»¤è¡Œå‚æ•°ä¸­ã€é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’<br>
åŠ¨æ€é…ç½®åŒ…å«å®šä¹‰ç³»ç»Ÿå¦‚ä½•å¤„ç†è¯·æ±‚çš„æ‰€æœ‰é…ç½®å†…å®¹ï¼Œè¿™äº›é…ç½®æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œè€Œä¸”æ˜¯æ— ç¼çƒ­æ›´æ–°çš„ï¼Œæ²¡æœ‰ä»»ä½•è¯·æ±‚ä¸­æ–­æˆ–è¿æ¥æŸè€—ã€‚<br>
åœ¨Kubernetesé›†ç¾¤ä¸‹ï¼Œé‡‡ç”¨Deploymentçš„æ–¹å¼éƒ¨ç½²traefikï¼Œå¹¶ä¸”æ‰“å¼€kubernetes ingressï¼Œä»¥åŠprometheus metricsã€‚<br>
<em>æ³¨ï¼šé»˜è®¤å®‰è£…åœ¨<strong>default</strong>ä¸‹</em></li>
</ul>
<h3 id="crdä¸rbac">CRDä¸RBAC</h3>
<p>é¦–å…ˆï¼Œå®šä¹‰CRDåŒ…æ‹¬IngressRouteå’ŒMiddlewareã€‚å¹¶ä¸”é€šè¿‡RBACæˆæƒèµ„æºã€‚<br>
å‚è§ï¼šhttps://github.com/HefeiJoe/traefik-k8s/blob/master/traefik-crd.yaml<br>
<em>æ³¨ï¼šé»˜è®¤å®‰è£…åœ¨<strong>default</strong>ä¸‹</em></p>
<pre><code>kubectl apply -f https://github.com/HefeiJoe/traefik-k8s/blob/master/traefik-crd.yaml
</code></pre>
<h3 id="service">Service</h3>
<p>å‚è§ï¼šhttps://github.com/HefeiJoe/traefik-k8s/blob/master/traefik-service.yaml</p>
<pre><code>kubectl apply -f https://github.com/HefeiJoe/traefik-k8s/blob/master/traefik-crd.yaml
</code></pre>
<p>éƒ¨ç½²å®Œæˆtraefikçš„EXTERNAL-IPä¸º<a href="http://172.21.92.148:8080/dashboard/#/">172.21.92.146</a></p>
<h3 id="deployments">Deployments</h3>
<p>å‚è§ï¼šhttps://github.com/HefeiJoe/traefik-k8s/blob/master/traefik-deployment.yaml</p>
<pre><code>kubectl apply -f https://github.com/HefeiJoe/traefik-k8s/blob/master/traefik-deployment.yaml
</code></pre>
<pre><code>apiVersion: v1
kind: ServiceAccount
metadata:
 name: traefik-ingress-controller
---
kind: Deployment
apiVersion: apps/v1
metadata:
 name: traefik
 labels:
  app: traefik
spec:
 replicas: 1
 selector:
  matchLabels:
   app: traefik
 template:
  metadata:
   labels:
â€‹    app: traefik
  spec:
   serviceAccountName: traefik-ingress-controller
   containers:
â€‹    - name: traefik
â€‹     image: traefik:v2.0.2
â€‹     args:
â€‹      - --api.insecure
â€‹      - --accesslog
â€‹      - --entrypoints.web.Address=:8000
â€‹      - --entrypoints.websecure.Address=:4443
â€‹      - --providers.kubernetescrd
â€‹      - --certificatesresolvers.default.acme.tlschallenge
â€‹      - --certificatesresolvers.default.acme.email=foo@you.com
â€‹      - --certificatesresolvers.default.acme.storage=acme.json
â€‹      - --providers.kubernetesingress=true
â€‹      - --providers.kubernetesingress.ingressclass=traefik
â€‹      - --metrics.prometheus=true
â€‹      - --entryPoints.metrics.address=:8082
â€‹      - --metrics.prometheus.entryPoint=metrics
â€‹      - --certificatesresolvers.default.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory
â€‹     ports:
â€‹      - name: web
â€‹       containerPort: 8000
â€‹      - name: websecure
â€‹       containerPort: 4443
â€‹      - name: admin
â€‹       containerPort: 8080
â€‹      - name: prometheus
â€‹       containerPort: 8082
</code></pre>
<h3 id="è®¿é—®dashboard">è®¿é—®DashBoard</h3>
<p>è®¿é—®8080ç«¯å£ï¼Œ<a href="http://172.21.92.148:8080/dashboard/#/">http://172.21.92.146:8080/dashboard/#/</a><br>
å¯ä»¥æŸ¥çœ‹å¼€å¯çš„ç«¯å£ã€æ·»åŠ çš„HTTPæœåŠ¡ã€æ·»åŠ çš„TCPæœåŠ¡ã€å¯ç”¨çš„Middlewareã€å¯ç”¨çš„Featuresã€å·²ç»æˆä¿¡çš„åŠŸèƒ½ã€‚<br>
<img src="https://uploader.shimo.im/f/9KL50flf9hg1UaL8.png!thumbnail" alt="img" loading="lazy"></p>
<h2 id="helm-chart">Helm Chart</h2>
<p>Helm Chartåœ°å€ï¼šhttps://github.com/containous/traefik-helm-chart<br>
helm install --namespace=default  ./traefik-helm-chart<br>
#ä½¿ç”¨</p>
<h3 id="éƒ¨ç½²whoamiæœåŠ¡">éƒ¨ç½²whoamiæœåŠ¡</h3>
<p>éƒ¨ç½²æµ‹è¯•æœåŠ¡whoami<br>
å‚è§ï¼šhttps://github.com/HefeiJoe/traefik-k8s/blob/master/whoami.yaml</p>
<h2 id="ingress">Ingress</h2>
<p>åœ¨traefikçš„Deploymentä¸­çš„argä¸‹æ·»åŠ CLI<br>
<em>- --providers.kubernetesingress=true</em><br>
<em>- --providers.kubernetesingress.ingressclass=traefik</em><br>
1ã€åˆ›å»ºIngress</p>
<pre><code>kind: Ingress
apiVersion: extensions/v1beta1
metadata:
  namespace: default
 name: traefik-ingress
 annotations:
  *# use the shared ingress-nginx*
  kubernetes.io/ingress.class: traefik
</code></pre>
<p>2ã€éªŒè¯<br>
è®¿é—®æœåŠ¡curl -i 172.21.92.146:8000  -H &quot;Host:whoami.kong.test&quot;ï¼Œæ¥å£å“åº”200<br>
<img src="https://uploader.shimo.im/f/ffocrRF3UjkXYBEb.png!thumbnail" alt="img" loading="lazy"></p>
<h2 id="ingressroute">IngressRoute</h2>
<pre><code>apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: simpleingressroute
  namespace: default
spec:
  entryPoints:
â€‹    - web
  routes:
  - match: Host(`172.21.92.148`) &amp;&amp; PathPrefix(`/whoami`)
â€‹    kind: Rule
â€‹    services:
â€‹    - name: whoami
â€‹      port: 80
</code></pre>
<p>é€šè¿‡http://172.21.92.148:8000/whoamiè®¿é—®</p>
<h2 id="middlewaresä¸­é—´ä»¶">Middlewaresï¼ˆä¸­é—´ä»¶ï¼‰</h2>
<h3 id="overviewæ¦‚è¿°">Overviewï¼ˆæ¦‚è¿°ï¼‰</h3>
<h3 id=""><img src="https://uploader.shimo.im/f/S1b2FXezLpQkSqx3.png!thumbnail" alt="img" loading="lazy"></h3>
<p>å°†ä¸­é—´ä»¶æ·»åŠ åˆ°Routeï¼Œåœ¨è¯·æ±‚å‘é€åˆ°æœåŠ¡ä¹‹å‰(æˆ–åœ¨æœåŠ¡çš„å“åº”å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰)è°ƒæ•´è¯·æ±‚ã€‚<br>
Traefikä¸­æœ‰è®¸å¤šä¸åŒçš„ä¸­é—´ä»¶ï¼Œæœ‰äº›å¯ä»¥ä¿®æ”¹è¯·æ±‚ã€å¤´æ–‡ä»¶ï¼Œæœ‰äº›è´Ÿè´£é‡å®šå‘ï¼Œæœ‰äº›æ·»åŠ èº«ä»½éªŒè¯ï¼Œç­‰ç­‰ã€‚<br>
<strong>ç»™Routeç»‘å®šMiddleware</strong><br>
åœ¨ingressRouteä¸­æ·»åŠ middlewares<br>
<em># As a Kubernetes Traefik IngressRoute</em></p>
<pre><code>apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: stripprefix
spec:
  stripPrefix:
â€‹    prefixes:
â€‹      - /stripit
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: simpleingressroute
  namespace: default
spec:
  entryPoints:
â€‹    - web
  routes:
  - match: Host(`172.21.92.148`) &amp;&amp; PathPrefix(`/whoami`)
â€‹    kind: Rule
â€‹    services:
â€‹    - name: whoami
â€‹      port: 80
â€‹    middlewares:
- name: stripprefix
</code></pre>
<p>Available Middlewares<a href="https://docs.traefik.io/middlewares/overview/#available-middlewares">Â¶</a></p>
<table>
<thead>
<tr>
<th>Middleware</th>
<th>Purpose</th>
<th>Area</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.traefik.io/middlewares/addprefix/">AddPrefix</a></td>
<td>Add a Path Prefix</td>
<td>Path Modifier</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/basicauth/">BasicAuth</a></td>
<td>Basic auth mechanism</td>
<td>Security, Authentication</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/buffering/">Buffering</a></td>
<td>Buffers the request/response</td>
<td>Request Lifecycle</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/chain/">Chain</a></td>
<td>Combine multiple pieces of middleware</td>
<td>Middleware tool</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/circuitbreaker/">CircuitBreaker</a></td>
<td>Stop calling unhealthy services</td>
<td>Request Lifecycle</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/compress/">Compress</a></td>
<td>Compress the response</td>
<td>Content Modifier</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/digestauth/">DigestAuth</a></td>
<td>Adds Digest Authentication</td>
<td>Security, Authentication</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/errorpages/">Errors</a></td>
<td>Define custom error pages</td>
<td>Request Lifecycle</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/forwardauth/">ForwardAuth</a></td>
<td>Authentication delegation</td>
<td>Security, Authentication</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/headers/">Headers</a></td>
<td>Add / Update headers</td>
<td>Security</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/ipwhitelist/">IPWhiteList</a></td>
<td>Limit the allowed client IPs</td>
<td>Security, Request lifecycle</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/inflightreq/">InFlightReq</a></td>
<td>Limit the number of simultaneous connections</td>
<td>Security, Request lifecycle</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/passtlsclientcert/">PassTLSClientCert</a></td>
<td>Adding Client Certificates in a Header</td>
<td>Security</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/ratelimit/">RateLimit</a></td>
<td>Limit the call frequency</td>
<td>Security, Request lifecycle</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/redirectscheme/">RedirectScheme</a></td>
<td>Redirect easily the client elsewhere</td>
<td>Request lifecycle</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/redirectregex/">RedirectRegex</a></td>
<td>Redirect the client elsewhere</td>
<td>Request lifecycle</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/replacepath/">ReplacePath</a></td>
<td>Change the path of the request</td>
<td>Path Modifier</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/replacepathregex/">ReplacePathRegex</a></td>
<td>Change the path of the request</td>
<td>Path Modifier</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/retry/">Retry</a></td>
<td>Automatically retry the request in case of errors</td>
<td>Request lifecycle</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/stripprefix/">StripPrefix</a></td>
<td>Change the path of the request</td>
<td>Path Modifier</td>
</tr>
<tr>
<td><a href="https://docs.traefik.io/middlewares/stripprefixregex/">StripPrefixRegex</a></td>
<td>Change the path of the request</td>
<td>Path Modifier</td>
</tr>
</tbody>
</table>
<h3 id="addprefixæ·»åŠ å‰ç¼€">AddPrefixï¼ˆæ·»åŠ å‰ç¼€ï¼‰</h3>
<p><img src="https://uploader.shimo.im/f/1hy4I9o9piED68sO.png!thumbnail" alt="img" loading="lazy"><br>
<em># Prefixing with /foo</em></p>
<pre><code>apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: add-foo
spec:
  addPrefix:
â€‹    prefix: /foo
</code></pre>
<table>
<thead>
<tr>
<th>é…ç½®é€‰é¡¹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>prefix</td>
<td>prefixæ˜¯æ·»åŠ åœ¨è¯·æ±‚çš„URLè·¯å¾„ä¹‹å‰çš„å­—ç¬¦ä¸²ã€‚å®ƒåº”è¯¥åŒ…æ‹¬å‰å¯¼æ–œæ (/)ã€‚å‚è€ƒ<a href="https://docs.traefik.io/middlewares/addprefix/#prefix">Â¶</a></td>
</tr>
</tbody>
</table>
<h3 id="basicauthåŸºæœ¬è®¤è¯">BasicAuthï¼ˆåŸºæœ¬è®¤è¯ï¼‰</h3>
<p><img src="https://uploader.shimo.im/f/IRa08Sg9kIIT5DuU.png!thumbnail" alt="img" loading="lazy"><br>
<em># Declaring the user list</em></p>
<pre><code>apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: test-auth
spec:
  basicAuth:
â€‹    secret: secretName
</code></pre>
<table>
<thead>
<tr>
<th>é…ç½®é€‰é¡¹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>secret</td>
<td>ç»‘å®šåˆ›å»ºçš„secretã€‚å‚è€ƒ<a href="https://docs.traefik.io/middlewares/basicauth/#configuration-examples">Â¶</a></td>
</tr>
<tr>
<td>users</td>
<td>è¯¥usersé€‰é¡¹æ˜¯ä¸€ç»„æˆæƒç”¨æˆ·ã€‚æ¯ä¸ªç”¨æˆ·éƒ½å°†ä½¿ç”¨ä»¥ä¸‹name:encoded-passwordæ ¼å¼å£°æ˜ã€‚å‚è€ƒ<a href="https://docs.traefik.io/middlewares/basicauth/#usersfile">Â¶</a></td>
</tr>
<tr>
<td>usersFile</td>
<td>è¯¥usersFileé€‰é¡¹æ˜¯åŒ…å«ä¸­é—´ä»¶æˆæƒç”¨æˆ·çš„å¤–éƒ¨æ–‡ä»¶çš„è·¯å¾„ã€‚å‚è€ƒ<a href="https://docs.traefik.io/middlewares/basicauth/#realm">Â¶</a></td>
</tr>
<tr>
<td>realm</td>
<td>æ‚¨å¯ä»¥ä½¿ç”¨realmé€‰é¡¹æ¥è‡ªå®šä¹‰èº«ä»½éªŒè¯é¢†åŸŸã€‚é»˜è®¤å€¼ä¸ºtraefikã€‚å‚è€ƒ<a href="https://docs.traefik.io/middlewares/basicauth/#realm">Â¶</a></td>
</tr>
<tr>
<td>headerField</td>
<td>æ‚¨å¯ä»¥ä½¿ç”¨è¯¥headerFieldé€‰é¡¹å®šä¹‰æ ‡é¢˜å­—æ®µä»¥å­˜å‚¨ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚å‚è€ƒ<a href="https://docs.traefik.io/middlewares/basicauth/#headerfield">Â¶</a></td>
</tr>
<tr>
<td>removeHeader</td>
<td>è®¾ç½®removeHeaderé€‰é¡¹ä»¥trueåœ¨å°†è¯·æ±‚è½¬å‘åˆ°æœåŠ¡ä¹‹å‰åˆ é™¤æˆæƒæ ‡å¤´ã€‚ï¼ˆé»˜è®¤å€¼ä¸ºfalseã€‚ï¼‰å‚è€ƒ<a href="https://docs.traefik.io/middlewares/basicauth/#removeheader">Â¶</a></td>
</tr>
</tbody>
</table>
<h3 id="circuitbreakeræ–­è·¯å™¨">CircuitBreakerï¼ˆæ–­è·¯å™¨ï¼‰</h3>
<p><img src="https://uploader.shimo.im/f/Jf3qvl3fwsgp5pDV.png!thumbnail" alt="img" loading="lazy"><br>
æ–­è·¯å™¨å¯ä¿æŠ¤æ‚¨çš„ç³»ç»Ÿå…äºå°†è¯·æ±‚å †å åˆ°ä¸æ­£å¸¸çš„æœåŠ¡ï¼ˆå¯¼è‡´çº§è”æ•…éšœï¼‰çš„éº»çƒ¦ã€‚<br>
ç³»ç»Ÿè¿è¡ŒçŠ¶å†µè‰¯å¥½æ—¶ï¼Œç”µè·¯å¤„äºé—­åˆçŠ¶æ€ï¼ˆæ­£å¸¸è¿è¡Œï¼‰ã€‚å½“ç³»ç»Ÿè¿è¡Œä¸æ­£å¸¸æ—¶ï¼Œç”µè·¯å°†æ–­å¼€ï¼Œå¹¶ä¸”ä¸å†è½¬å‘è¯·æ±‚ï¼ˆè€Œæ˜¯ç”±åå¤‡æœºåˆ¶å¤„ç†ï¼‰ã€‚<br>
ä¸ºäº†è¯„ä¼°æ‚¨çš„ç³»ç»Ÿæ˜¯å¦å¥åº·ï¼Œæ–­è·¯å™¨ä¸æ–­ç›‘è§†æœåŠ¡ã€‚<br>
<em># Latency Check</em></p>
<pre><code>apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: latency-check
spec:
  circuitBreaker:
â€‹    expression: LatencyAtQuantileMS(50.0) &gt; 100
</code></pre>
<table>
<thead>
<tr>
<th>é…ç½®é€‰é¡¹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>NetworkErrorRatio</td>
<td>å¦‚æœæ‚¨å¸Œæœ›æ–­è·¯å™¨ä»¥30ï¼…çš„ç½‘ç»œé”™è¯¯ç‡è§¦å‘ï¼Œåˆ™è¡¨è¾¾å¼ä¸º NetworkErrorRatio() &gt; 0.30ã€‚å‚è€ƒ<a href="https://docs.traefik.io/middlewares/addprefix/#prefix">Â¶</a></td>
</tr>
<tr>
<td>ResponseCodeRatio</td>
<td>æ‚¨å¯ä»¥æ ¹æ®ç»™å®šèŒƒå›´çš„çŠ¶æ€ç çš„æ¯”ç‡æ¥è§¦å‘æ–­è·¯å™¨ã€‚åœ¨ResponseCodeRatioæ¥å—å››ä¸ªå‚æ•°ï¼Œfromï¼Œtoï¼ŒdividedByFromï¼ŒdividedByToã€‚ä¾‹å¦‚ï¼ŒResponseCodeRatio(500, 600, 0, 600) &gt; 0.25å¦‚æœ25ï¼…çš„è¯·æ±‚è¿”å›5XXçŠ¶æ€ï¼ˆåœ¨è¿”å›çŠ¶æ€ä»£ç ä»0åˆ°5XXçš„è¯·æ±‚ä¸­ï¼‰ï¼Œåˆ™è¡¨è¾¾å¼å°†è§¦å‘æ–­è·¯å™¨ã€‚å‚è€ƒ<a href="https://docs.traefik.io/middlewares/circuitbreaker/#responsecoderatio">Â¶</a></td>
</tr>
<tr>
<td>LatencyAtQuantileMS</td>
<td>å½“ç»™å®šæ¯”ä¾‹çš„è¯·æ±‚å˜å¾—å¤ªæ…¢æ—¶ï¼Œæ‚¨å¯ä»¥è§¦å‘æ–­è·¯å™¨ã€‚ä¾‹å¦‚ï¼Œå½“ä¸­LatencyAtQuantileMS(50.0) &gt; 100å€¼ç­‰å¾…æ—¶é—´ï¼ˆåˆ†ä½æ•°50ï¼‰è¾¾åˆ°100MSæ—¶ï¼Œè¯¥è¡¨è¾¾å¼å°†è§¦å‘æ–­è·¯å™¨ã€‚å‚è€ƒ<a href="https://docs.traefik.io/middlewares/circuitbreaker/#latencyatquantilems">Â¶</a>æ‚¨å¿…é¡»æä¾›åˆ†ä½æ•°çš„æµ®ç‚¹æ•°ï¼ˆåè·Ÿ.0ï¼‰</td>
</tr>
</tbody>
</table>
<h2 id="metrics">Metrics</h2>
<h3 id="prometheus">Prometheus</h3>
<p>åœ¨traefikçš„Deploymentä¸­çš„argä¸‹æ·»åŠ CLIï¼ˆå¦‚æœé‡‡ç”¨HelmChartéƒ¨ç½²ï¼Œåœ¨values.yamlçš„additionalArgumentsä¸‹æ·»åŠ ä»¥ä¸‹CLIï¼‰ï¼Œå¹¶ä¸”ä¿®æ”¹Serviceæš´éœ²ç«¯å£8082<br>
<em>- --metrics.prometheus=true</em><br>
<em>- --entryPoints.metrics.address=:8082</em><br>
<em>- --metrics.prometheus.entryPoint=metrics</em><br>
é€šè¿‡8082ç«¯å£å¯ä»¥æŸ¥çœ‹prometheusçš„metricsï¼Œ<a href="http://172.21.92.148:8082/metrics">http://172.21.92.146:8082/metrics</a></p>
<h2 id="tracing">Tracing</h2>
<h3 id="zipkin">Zipkin</h3>
<p>1ã€éƒ¨ç½²Zipkin<br>
ç•¥<br>
2ã€åœ¨traefikçš„Deploymentä¸­çš„argä¸‹æ·»åŠ CLIï¼ˆå¦‚æœé‡‡ç”¨HelmChartéƒ¨ç½²ï¼Œåœ¨values.yamlçš„additionalArgumentsä¸‹æ·»åŠ ä»¥ä¸‹CLIï¼‰<br>
<em>- --tracing.zipkin=true</em><br>
<em>- --tracing.zipkin.httpEndpoint=http://localhost:9411/api/v2/spans</em><br>
<em>- --tracing.zipkin.sampleRate=1.0</em><br>
è®¿é—®zipkinçš„åœ°å€ï¼Œhttp://localhost:9411/</p>
]]></content>
    </entry>
</feed>